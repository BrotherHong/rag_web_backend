# ğŸ—ï¸ ç³»çµ±æ¶æ§‹ç¸½è¦½

## æ•´é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä½¿ç”¨è€…ç€è¦½å™¨                              â”‚
â”‚                  (React 18.3.1 + Vite)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP/HTTPS
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Nginx åå‘ä»£ç†                              â”‚
â”‚             SSL/TLS, Load Balancing, CORS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                            â”‚
       â–¼                                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯éœæ…‹è³‡æº   â”‚                    â”‚   FastAPI å¾Œç«¯ API   â”‚
â”‚   Port: 5173    â”‚                    â”‚    Port: 8000        â”‚
â”‚   (é–‹ç™¼ç’°å¢ƒ)     â”‚                    â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                              â”‚                â”‚
                    â–¼                              â–¼                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   PostgreSQL 16  â”‚          â”‚   Redis 7    â”‚   â”‚   MinIO      â”‚
         â”‚   ä¸»è³‡æ–™åº«        â”‚          â”‚   å¿«å–/ä½‡åˆ—   â”‚   â”‚  ç‰©ä»¶å„²å­˜     â”‚
         â”‚   Port: 5432     â”‚          â”‚  Port: 6379  â”‚   â”‚  Port: 9000  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Qdrant         â”‚
         â”‚   å‘é‡è³‡æ–™åº«      â”‚
         â”‚   Port: 6333     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒçµ„ä»¶èªªæ˜

### 1. å‰ç«¯å±¤ (Frontend)
- **æ¡†æ¶**: React 19.1.1 + Vite 7.1.7
- **è·è²¬**: 
  - ä½¿ç”¨è€…ä»‹é¢æ¸²æŸ“
  - å‰ç«¯è·¯ç”±ç®¡ç†
  - API è«‹æ±‚å°è£
  - ç‹€æ…‹ç®¡ç† (Context API)
- **éƒ¨ç½²**: Nginx éœæ…‹æª”æ¡ˆæœå‹™
- **å°ˆæ¡ˆä½ç½®**: `rag_web_admin/`

### 2. åå‘ä»£ç†å±¤ (Nginx)
- **ç‰ˆæœ¬**: Nginx 1.25+ (Alpine)
- **è·è²¬**:
  - SSL/TLS çµ‚æ­¢
  - è² è¼‰å¹³è¡¡
  - éœæ…‹æª”æ¡ˆæœå‹™
  - CORS è™•ç†
  - è«‹æ±‚é™æµ
- **é…ç½®**: 80/443 ç«¯å£

### 3. æ‡‰ç”¨å±¤ (FastAPI Backend)
- **æ¡†æ¶**: FastAPI 0.115.0
- **ASGI ä¼ºæœå™¨**: Uvicorn 0.30.0
- **è·è²¬**:
  - RESTful API æœå‹™
  - æ¥­å‹™é‚è¼¯è™•ç†
  - èªè­‰èˆ‡æˆæ¬Š (JWT)
  - æª”æ¡ˆè™•ç†
  - RAG æŸ¥è©¢è™•ç†
- **éƒ¨ç½²**: Docker å®¹å™¨
- **å°ˆæ¡ˆä½ç½®**: `rag_web_backend/` (å¾…å»ºç«‹)

### 4. è³‡æ–™æŒä¹…å±¤

#### PostgreSQL (ä¸»è³‡æ–™åº«)
- **ç‰ˆæœ¬**: PostgreSQL 16
- **è·è²¬**:
  - çµæ§‹åŒ–è³‡æ–™å„²å­˜
  - ä½¿ç”¨è€…ã€è™•å®¤ã€æª”æ¡ˆå…ƒè³‡æ–™
  - æ´»å‹•è¨˜éŒ„ã€ç³»çµ±è¨­å®š
  - ACID äº‹å‹™ä¿è­‰
- **ORM**: SQLAlchemy 2.0 (Async)

#### Redis (å¿«å–èˆ‡ä½‡åˆ—)
- **ç‰ˆæœ¬**: Redis 7
- **è·è²¬**:
  - Session ç®¡ç†
  - API å¿«å–
  - é€Ÿç‡é™åˆ¶
  - ä»»å‹™ä½‡åˆ— (Celery)
  - å³æ™‚é€²åº¦è¿½è¹¤
- **æ¨¡å¼**: 
  - Cache: LRU (2GB)
  - Queue: Celery Broker

#### Qdrant (å‘é‡è³‡æ–™åº«)
- **ç‰ˆæœ¬**: Qdrant Latest
- **è·è²¬**:
  - æ–‡ä»¶å‘é‡å„²å­˜
  - èªç¾©æœå°‹
  - RAG æª¢ç´¢
- **å‘é‡ç¶­åº¦**: 1536 (OpenAI text-embedding-ada-002)

#### MinIO (ç‰©ä»¶å„²å­˜)
- **ç‰ˆæœ¬**: MinIO Latest
- **è·è²¬**:
  - æª”æ¡ˆå„²å­˜
  - å‚™ä»½å„²å­˜
  - åˆ†æ•£å¼æª”æ¡ˆç®¡ç†
- **æ›¿ä»£æ–¹æ¡ˆ**: æœ¬åœ°æª”æ¡ˆç³»çµ± (é–‹ç™¼ç’°å¢ƒ)

---

## è³‡æ–™æµå‘

### ä½¿ç”¨è€…ç™»å…¥æµç¨‹
```
ä½¿ç”¨è€… â†’ å‰ç«¯ â†’ POST /api/auth/login â†’ FastAPI
                                       â†“
                                  é©—è­‰å¯†ç¢¼ (bcrypt)
                                       â†“
                                  ç”Ÿæˆ JWT Token
                                       â†“
                              å„²å­˜ Session (Redis)
                                       â†“
                              è¿”å› Token + ä½¿ç”¨è€…è³‡è¨Š
                                       â†“
å‰ç«¯å„²å­˜ Token (localStorage) â† â† â† â† â†
```

### æª”æ¡ˆä¸Šå‚³æµç¨‹
```
ä½¿ç”¨è€…é¸æ“‡æª”æ¡ˆ â†’ å‰ç«¯ â†’ POST /api/files/upload (multipart/form-data)
                                    â†“
                            FastAPI æ¥æ”¶æª”æ¡ˆ
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                â–¼
            å„²å­˜å¯¦é«”æª”æ¡ˆ                        æª”æ¡ˆå…ƒè³‡æ–™å­˜å…¥
            (MinIO/Local)                      PostgreSQL
                    â”‚                                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
                          å»ºç«‹ Celery ä»»å‹™ (ç•°æ­¥)
                                    â†“
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â–¼                       â–¼
                æ–‡å­—æå–èˆ‡è™•ç†          é€²åº¦æ›´æ–° (Redis)
                (PDF/DOCX/TXT)                  â”‚
                        â†“                       â”‚
                å‘é‡åŒ– (OpenAI Embeddings)      â”‚
                        â†“                       â”‚
                å„²å­˜å‘é‡ (Qdrant)               â”‚
                        â†“                       â”‚
                    å®Œæˆé€šçŸ¥  â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’â”˜
```

### RAG æŸ¥è©¢æµç¨‹
```
ä½¿ç”¨è€…æå• â†’ å‰ç«¯ â†’ POST /api/rag/query
                            â†“
                    å•é¡Œå‘é‡åŒ– (OpenAI)
                            â†“
                    å‘é‡æª¢ç´¢ (Qdrant)
                            â†“
                    å–å¾—ç›¸é—œæ–‡ä»¶ç‰‡æ®µ (Top-K)
                            â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                                 â–¼
    æª¢æŸ¥å¿«å– (Redis)                   å»ºç«‹ Prompt
            â”‚                                 â”‚
        å‘½ä¸­å¿«å–?                              â”‚
            â”‚                                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
    â–¼               â–¼                        â–¼
   è¿”å›å¿«å–      å‘¼å« LLM API           çµ„åˆä¸Šä¸‹æ–‡ + å•é¡Œ
                (OpenAI/Claude)                â”‚
                      â”‚                        â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–¼
                        ç”Ÿæˆå›ç­” + å¼•ç”¨ä¾†æº
                               â†“
                        å„²å­˜å¿«å– (Redis, 1h)
                               â†“
                        è¿”å›çµæœçµ¦å‰ç«¯
```

---

## ä¸¦ç™¼è™•ç†ç­–ç•¥

### å¤šä½¿ç”¨è€…ä½µç™¼
```python
# FastAPI ç•°æ­¥è™•ç†
@router.post("/files/upload")
async def upload_file(
    file: UploadFile,
    db: AsyncSession = Depends(get_db)
):
    # æ¯å€‹è«‹æ±‚åœ¨ç¨ç«‹çš„å”ç¨‹ä¸­è™•ç†
    # ä¸æœƒé˜»å¡å…¶ä»–ä½¿ç”¨è€…çš„è«‹æ±‚
    pass
```

### è³‡æ–™åº«é€£ç·šæ± 
```python
# PostgreSQL é€£ç·šæ± è¨­å®š
engine = create_async_engine(
    DATABASE_URL,
    pool_size=20,          # åŸºæœ¬é€£ç·šæ•¸
    max_overflow=40,       # æœ€å¤§æº¢å‡ºé€£ç·š
    pool_pre_ping=True,    # é€£ç·šå‰æª¢æ¸¬
    pool_recycle=3600      # 1å°æ™‚å›æ”¶é€£ç·š
)
```

### èƒŒæ™¯ä»»å‹™è™•ç†
```python
# Celery å·¥ä½œè€…
celery -A app.tasks worker --loglevel=info --concurrency=4

# ä»»å‹™é¡å‹
- æª”æ¡ˆè™•ç† (é«˜å„ªå…ˆç´š)
- å‘é‡åŒ– (ä¸­å„ªå…ˆç´š)
- å‚™ä»½ (ä½å„ªå…ˆç´š)
```

---

## å®‰å…¨æ¶æ§‹

### èªè­‰èˆ‡æˆæ¬Š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JWT Token      â”‚
â”‚  â”œâ”€ user_id     â”‚
â”‚  â”œâ”€ role        â”‚
â”‚  â”œâ”€ exp (24h)   â”‚
â”‚  â””â”€ iat         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¬Šé™æª¢æŸ¥        â”‚
â”‚  â”œâ”€ super_admin â”‚  â†’ æ‰€æœ‰æ¬Šé™
â”‚  â”œâ”€ admin       â”‚  â†’ è™•å®¤å…§æ¬Šé™
â”‚  â””â”€ viewer      â”‚  â†’ å”¯è®€æ¬Šé™
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API å®‰å…¨
- **CORS**: é™åˆ¶ä¾†æº (å‰ç«¯ç¶²å€)
- **Rate Limiting**: æ¯åˆ†é˜ 100 æ¬¡è«‹æ±‚
- **SQL Injection**: ä½¿ç”¨ ORM åƒæ•¸åŒ–æŸ¥è©¢
- **XSS**: è¼¸å…¥é©—è­‰èˆ‡æ¸…ç†
- **CSRF**: Token é©—è­‰

### è³‡æ–™éš”é›¢
```python
# è™•å®¤è³‡æ–™éš”é›¢
@router.get("/files")
async def get_files(
    current_user: User = Depends(get_current_user)
):
    # è‡ªå‹•éæ¿¾ï¼šåªè¿”å›è©²è™•å®¤çš„æª”æ¡ˆ
    files = await file_service.get_files(
        department_id=current_user.department_id
    )
```

---

## æ•ˆèƒ½ç›®æ¨™

| æŒ‡æ¨™ | ç›®æ¨™å€¼ | èªªæ˜ |
|------|--------|------|
| API å›æ‡‰æ™‚é–“ | < 200ms | æœ‰å¿«å–çš„æƒ…æ³ä¸‹ |
| æª”æ¡ˆä¸Šå‚³é€Ÿåº¦ | > 10MB/s | å€åŸŸç¶²è·¯ç’°å¢ƒ |
| ä¸¦ç™¼ä½¿ç”¨è€…æ•¸ | 100-500 äºº | åŒæ™‚ç·šä¸Š |
| RAG æŸ¥è©¢å»¶é² | < 3s | åŒ…å« LLM å›æ‡‰ |
| è³‡æ–™åº«æŸ¥è©¢ | < 50ms | å–®æ¬¡æŸ¥è©¢ |
| Redis å¿«å–å‘½ä¸­ç‡ | > 80% | ç†±é–€è³‡æ–™ |

---

## å¯æ“´å±•æ€§è¨­è¨ˆ

### æ°´å¹³æ“´å±•
```yaml
# Docker Compose å¤šå¯¦ä¾‹
services:
  backend:
    image: rag-backend
    deploy:
      replicas: 3  # 3 å€‹å¾Œç«¯å¯¦ä¾‹
    depends_on:
      - postgres
      - redis
```

### å‚ç›´æ“´å±•
- **è³‡æ–™åº«**: PostgreSQL ä¸»å¾è¤‡è£½
- **å¿«å–**: Redis Cluster
- **æª”æ¡ˆ**: MinIO åˆ†æ•£å¼éƒ¨ç½²
- **å‘é‡**: Qdrant åˆ†ç‰‡

---

## ç›£æ§èˆ‡æ—¥èªŒ

### æ‡‰ç”¨ç›£æ§
- **APM**: Prometheus + Grafana
- **æ—¥èªŒ**: ELK Stack (Elasticsearch, Logstash, Kibana)
- **è¿½è¹¤**: Jaeger (åˆ†æ•£å¼è¿½è¹¤)

### å¥åº·æª¢æŸ¥
```python
@router.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "database": await check_db(),
        "redis": await check_redis(),
        "qdrant": await check_qdrant()
    }
```

---

**ä¸‹ä¸€æ­¥**: é–±è®€ [02_TECH_STACK.md](./02_TECH_STACK.md) äº†è§£è©³ç´°çš„æŠ€è¡“å †ç–Š
